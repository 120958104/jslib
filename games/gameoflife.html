<html>
<head>
<script src="../lib.js"></script>
<style>
#canvas-container {
	text-align:center;
}
canvas {
	display: inline;
	border:1px solid #000000;
}
</style>
</head>
<body>
	<a href="../index.html">Back</a>
<canvas height="400" width="400" id="myCanvas"></canvas>
<script>
	var canvas = new pjs("myCanvas");

	var paused = true;
	var state = [];
	for(var i = 0; i < 40; i++) state.push([]);

	for(var i = 0; i < state.length; i++){
		for(var i2 = 0; i2 < 40; i2++){
			state[i].push(false);
		}
	}
	var clear = function(){
		state = [];
		for(var i = 0; i < 40; i++) state.push([]);
		for(var i = 0; i < state.length; i++){
			for(var i2 = 0; i2 < 40; i2++){
				state[i].push(true);
			}
		}
	}
	pjs.draw = function(){
		for(var x = 0; x < state.length; x++){
			for(var y = 0; y < state[x].length; y++){
				if(state[x][y]){
					canvas.fill(230, 230, 0);
				} else {
					canvas.fill(255, 255, 255);
				}
				canvas.rect(x * 10, y * 10, 10, 10);
			}
		}
		if(paused === false){
			step();
		}
	}
	pjs.mouseClicked = function(e){
		
		var x = Math.floor(canvas.getMouseOffset().x/10)
		var y = Math.floor(canvas.getMouseOffset().y/10)
		if(x > state.length  || x < 0){
			return;
		}
		try{
			if(y > state[x].length || y < 0){
				return;
			}
		} catch(Error){
			return; //probably bad practice but i'm sick of dealing with this
		}
		if(state[x][y]){
			state[x][y] = false;
		} else{
			state[x][y] = true;
		}
	}
	var togglePause = function(){
		if(paused){
			paused = false;
			document.getElementById("runButton").textContent = "Stop";
		} else {
			paused = true;
			document.getElementById("runButton").textContent = "Run";
		}
	}
	var step = function(clear = false){
		var setToFalse = [];
		var setToTrue = [];
		for(var x = 0; x < state.length; x++){
			for(var y = 0; y < state[x].length; y++){
				try{
					var neighbors = 0;
					if(state[x - 1][y - 1]){neighbors++;} //1
					if(state[x][y - 1]){neighbors++;} //2
					if(state[x + 1][y - 1]){neighbors++;} //3
					if(state[x - 1][y]){neighbors++;} //4
					if(state[x + 1][y]){neighbors++;} //5
					if(state[x - 1][y + 1]){neighbors++;} //6
					if(state[x][y + 1]){neighbors++;} //7
					if(state[x + 1][y + 1]){neighbors++;} //8

					if(neighbors > 3 || neighbors < 2){
						setToFalse.push([x, y]);
					}
					if(neighbors === 3){
						setToTrue.push([x, y]);
					}
					if(clear){
						setToFalse.push([x, y]);//bad code but i'm sick of dealing with this bug
					}
				} catch(error){
					setToFalse.push([x, y]); //unused cells should not be alive
				}
			}
		}
		if(clear){ //bad code but i'm sick of dealing with this bug
			setToTrue = [];
		}
		for(var i = 0; i < setToFalse.length; i++){
			state[setToFalse[i][0]][setToFalse[i][1]] = false;
		}
		for(var i = 0; i < setToTrue.length; i++){
			state[setToTrue[i][0]][setToTrue[i][1]] = true;
		}
	}
</script>
<button onClick="step()">Step</button>
<button onClick="togglePause()" id="runButton">Run</button>
<button onClick="step(true)">Clear</button>
</body>
</html>
